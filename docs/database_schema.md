# TODOアプリのデータベース設計解説

## 概要

このTODOアプリのデータベース設計は、PostgreSQLとPrisma ORMを使用して構築されています。データモデルは、ユーザー、タスク、タグの3つの主要エンティティと、タスクとタグの関連付けを行う中間テーブルで構成されています。

## データベースモデル詳細

### 1. User（ユーザー）モデル

ユーザーはアプリケーションの基本的なアカウント情報を管理します。

| フィールド | 型      | 説明                       | 特記事項                  |
|-----------|---------|----------------------------|---------------------------|
| id        | UUID    | ユーザーの一意識別子        | プライマリキー、自動生成   |
| email     | String  | ユーザーのメールアドレス    | 一意制約あり              |
| password  | String  | ハッシュ化されたパスワード  | bcryptでハッシュ化して保存|
| name      | String  | ユーザーの表示名           |                          |
| createdAt | DateTime| レコード作成日時           | 自動設定                  |
| updatedAt | DateTime| レコード更新日時           | 自動更新                  |

### 2. Task（タスク）モデル

タスクはTODOリストの個々のアイテムを表します。

| フィールド   | 型       | 説明                    | 特記事項                |
|-------------|----------|-------------------------|-------------------------|
| id          | UUID     | タスクの一意識別子       | プライマリキー、自動生成 |
| title       | String   | タスクのタイトル        | 必須                    |
| description | String?  | タスクの詳細説明        | 任意                    |
| completed   | Boolean  | タスクの完了状態        | デフォルトはfalse       |
| priority    | Enum     | タスクの優先度          | LOW, MEDIUM, HIGH      |
| dueDate     | DateTime?| タスクの期限日時        | 任意                    |
| userId      | UUID     | タスクの所有者ID        | 外部キー                |
| createdAt   | DateTime | レコード作成日時        | 自動設定                |
| updatedAt   | DateTime | レコード更新日時        | 自動更新                |

### 3. Tag（タグ）モデル

タグはタスクをカテゴリ分けするために使用されます。

| フィールド  | 型       | 説明                    | 特記事項                |
|------------|----------|-------------------------|-------------------------|
| id         | UUID     | タグの一意識別子         | プライマリキー、自動生成 |
| name       | String   | タグの名前              | ユーザーごとに一意      |
| color      | String   | タグの表示色            | HEX形式のカラーコード   |
| userId     | UUID     | タグの所有者ID          | 外部キー                |
| createdAt  | DateTime | レコード作成日時        | 自動設定                |
| updatedAt  | DateTime | レコード更新日時        | 自動更新                |

### 4. TaskTag（タスクとタグの関連）モデル

タスクとタグの多対多の関係を管理するための中間テーブルです。

| フィールド | 型       | 説明                   | 特記事項               |
|-----------|----------|------------------------|------------------------|
| id        | UUID     | 関連の一意識別子        | プライマリキー、自動生成|
| taskId    | UUID     | タスクの参照ID         | 外部キー               |
| tagId     | UUID     | タグの参照ID           | 外部キー               |
| createdAt | DateTime | レコード作成日時       | 自動設定               |

## リレーションシップ

1. **User <-> Task**: 一対多
   - ユーザーは複数のタスクを持ちます
   - タスクは必ず1人のユーザーに属します
   - ユーザーが削除されると、関連するすべてのタスクも削除されます（カスケード削除）

2. **User <-> Tag**: 一対多
   - ユーザーは複数のタグを持ちます
   - タグは必ず1人のユーザーに属します
   - ユーザーが削除されると、関連するすべてのタグも削除されます（カスケード削除）

3. **Task <-> Tag**: 多対多（TaskTagを介して）
   - タスクは複数のタグを持つことができます
   - タグは複数のタスクに関連付けられます
   - タスクが削除されると、関連するTaskTagレコードも削除されます（カスケード削除）
   - タグが削除されると、関連するTaskTagレコードも削除されます（カスケード削除）

## インデックス設計

パフォーマンスを向上させるために以下のインデックスを設定しています：

1. `users` テーブル
   - `email` フィールドに一意インデックス

2. `tasks` テーブル
   - `userId` フィールドにインデックス（ユーザーごとのタスク検索を高速化）

3. `tags` テーブル
   - `userId` フィールドにインデックス（ユーザーごとのタグ検索を高速化）
   - `[name, userId]` の複合一意インデックス（ユーザーごとにタグ名の一意性を確保）

4. `task_tags` テーブル
   - `taskId` フィールドにインデックス
   - `tagId` フィールドにインデックス
   - `[taskId, tagId]` の複合一意インデックス（同じタスクに同じタグを重複して追加できないように）

## データベースの命名規則

- テーブル名：スネークケース、複数形（例：`users`, `tasks`）
- カラム名：スネークケース（例：`user_id`, `created_at`）
- 関連フィールド：元のモデル名 + Id（例：`userId`）

## 拡張性と将来の考慮

1. **サブタスク機能**: 将来的にタスクにサブタスクを追加する場合は、Taskモデルに自己参照関係を追加することで実装可能です。

2. **共有機能**: 将来的にタスクの共有機能を追加する場合は、新たに共有テーブル（Shares）を作成し、ユーザーとタスクの関連付けを管理することで実装可能です。

3. **通知機能**: タスクの期限に関する通知機能を追加する場合は、Notificationモデルを新たに作成することで実装可能です。
